<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="drawingboard.min.css">

  <script src="jquery.min.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="jquery-1.12.4.js"></script>
  <script src="jquery-ui.js"></script>

  <script src="drawingboard.min.js"></script>


  <style>
  img.preview {
    transform: scaleX(-1);
    transform: scaleY(-1);
    float: none;
    margin: 0 auto;
  }
  body {
    min-height: 75rem;
    padding-top: 4.5rem;
  }
  #board {
    width: 600px;
    height: 600px;
  }
  </style>
  <title>FIST Web UI</title>
</head>
<body>

  <!--Simulation Settings Script-->
  <script>

  //import default values
  var DEF_VALUES_STRING = $.getJSON({ 'url': "./ed_control_default_values.json", 'async': false }).responseText;
  var simulationValues = JSON.parse(DEF_VALUES_STRING);
  simulationValues.xres = 1920;
  simulationValues.yres = 1080;

  var isPreviewAdded = false;
  var img = document.createElement('img');
  img.className="preview"
  var socket=null;
  var socketAddr="127.0.0.1:3012"

  var connectServer = function(){
    console.log("Connecting");
    socket = new WebSocket("ws://"+socketAddr);


    socket.onmessage = function (event) {
      var blob = new Blob([event.data], {type: 'image/jpeg'});
      var objurl = window.URL.createObjectURL(blob);
      //var img = new Image();
      img.src = objurl;
      //console.log(event.data.size);
      var oldHeight=img.height;
      var oldWidth=img.width;
      if(oldHeight!=0&&oldWidth!=0){
        var ratio = (1.0*oldWidth)/(1.0*oldHeight);
        //console.log(oldHeight+"x"+oldWidth);
        var maxWidth=700.0;
        img.width = maxWidth;
        img.height = maxWidth/ratio;
        if(! isPreviewAdded){
          isPreviewAdded = true;
          document.getElementById("previewDiv").appendChild(img);
        }
      }
    };
    socket.onerror = function (event) {
      //setTimeout(function(){connectServer()}, 5000);
      document.getElementById("conBtn").classList.remove('btn-success');
      document.getElementById("conBtn").classList.add('btn-danger');
    };
    socket.onclose = function(){
      //setTimeout(function(){connectServer()}, 5000);
      document.getElementById("conBtn").classList.remove('btn-success');
      document.getElementById("conBtn").classList.add('btn-danger');
    };
    socket.onopen = function(){
      document.getElementById("conBtn").classList.remove('btn-danger');
      document.getElementById("conBtn").classList.add('btn-success');
    };
  }
  //store elements + update functions
  var elementUpdateFunctions = new Map();

  //called when a ui-value has changed
  var changeValue = function (id, value) {
    console.log(typeof value)
    simulationValues[id] = value;
    console.log(id + " value changed to " + value);
    updateSettings(simulationValues);
  }

  //called when there is a new settings file
  var updateSettingElements = function (newValues) {
    console.log("START update settings");
    elementUpdateFunctions.forEach(function (update, id) {
      update(newValues[id]);
    }, elementUpdateFunctions);
    console.log("END update settings");
  }

  // sends settings to desktop app
  var updateSettings = function (settings) {
    console.log("Sending settings: " + settings);
    if(socket!=null){
      socket.send(JSON.stringify(settings));
    }
  };

  //helper function for download
  function encode( s ) {
    var out = [];
    for ( var i = 0; i < s.length; i++ ) {
      out[i] = s.charCodeAt(i);
    }
    return new Uint8Array( out );
  }

  // handle click on connect button
  function conBtnClick(settings) {
    var txt = document.getElementById("conUrl").value;
    if(txt!=null&&txt!=""){
      socketAddr = txt;
    }
    connectServer();
  };

  // Downloads the current ed config as file
  // thanks to http://jsfiddle.net/soulwire/4ooupev9/
  function downloadConfig() {
    var data = encode( JSON.stringify(simulationValues, null, 4) );

    var blob = new Blob( [ data ], {
      type: 'application/octet-stream'
    });

    url = URL.createObjectURL( blob );
    var link = document.createElement( 'a' );
    link.setAttribute( 'href', url );
    link.setAttribute( 'download', 'example.json' );

    var event = document.createEvent( 'MouseEvents' );
    event.initMouseEvent( 'click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
    link.dispatchEvent( event );
  }

  // upload a file and replace the current config with it
  // directly sends it to desktop app
  var openFile = function(file) {
    var input = file.target;
    simulationValues=JSON.parse(input.files[0]);
    updateSettings(simulationValues);
  };

  var sendInput = function(file) {
    socket.send("inp")
    var input = file.target;
    socket.send(input.files[0]);
  };

  var sendRetina = function(file) {
    socket.send("rtn")
    var input = file.target;
    socket.send(input.files[0]);
  };

  var sendDepth = function(file) {
    socket.send("dph")
    var input = file.target;
    socket.send(input.files[0]);
  };

  var sendCornea = function(file) {
    socket.send("crn")
    var input = file.target;
    socket.send(input.files[0]);
  };

  function sendBoardInput() {
    img_board = myBoard.getImg();
    blob = dataURItoBlob(img_board);
    socket.send("inp")
    socket.send(blob);
  }

  function sendBoardRetina() {
    img_board = myBoard.getImg();
    blob = dataURItoBlob(img_board);
    socket.send("rtn")
    socket.send(blob);
  }


  // https://stackoverflow.com/questions/4998908/convert-data-uri-to-file-then-append-to-formdata
  function dataURItoBlob(dataURI) {
    // convert base64/URLEncoded data component to raw binary data held in a string
    var byteString;
    if (dataURI.split(',')[0].indexOf('base64') >= 0)
    byteString = atob(dataURI.split(',')[1]);
    else
    byteString = unescape(dataURI.split(',')[1]);

    // separate out the mime component
    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

    // write the bytes of the string to a typed array
    var ia = new Uint8Array(byteString.length);
    for (var i = 0; i < byteString.length; i++) {
      ia[i] = byteString.charCodeAt(i);
    }

    return new Blob([ia], {type:mimeString});
  }


  </script>

  <div class="container">
    <div class="row">
      <div id="previewDiv" class="panel-default">
      </div>
      <br />
      <div class="input-group">
        <span class="input-group-addon">ws://</span>
        <input type="text" class="form-control" id="conUrl"placeholder="127.0.0.1:3012">
        <span class="input-group-btn">
          <button id="conBtn" onclick="conBtnClick()" class="btn" >Connect</button>
        </span>
      </div>
      <br />
    </div>



    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a href="#1" aria-controls="1" role="tab" data-toggle="tab">Settings</a></li>
      <li role="presentation"><a href="#2" aria-controls="2" role="tab" data-toggle="tab">Import/Export</a></li>
      <li role="presentation"><a href="#3" aria-controls="3" role="tab" data-toggle="tab">File Upload</a></li>
      <li role="presentation"><a href="#4" aria-controls="4" role="tab" data-toggle="tab">Drawing Mode</a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">

      <!-- Settings -->
      <div role="tabpanel" class="tab-pane active" id="1">
        <div class="row">
          <!--
achromatopsia = id
Farbenblindheit = name
INSERT_ELEMENTS = ed-control-elements
-->
<!--<div id="achromatopsia_control" class="edControl">-->

<div class="edTable col-sm-12 col-md-4 col-lg-3 panel panel-default">

    <!--ed_header-->
    <div id="achromatopsia_header" class="edHeader row panel-heading">
        <div data-toggle="collapse" data-target="#achromatopsia_elements" align="left" class="col-xs-10">
            <label class="edTitle" id="achromatopsia_label">Farbenblindheit</label>
        </div>
        <div class="col-xs-2">
            <label class="edOnOffElement">
                <input id="achromatopsia_onoff" type="checkbox">
                <span class="lever"></span>
            </label>
            <script>
                var achromatopsia_jsvar = document.getElementById("achromatopsia_onoff");

                if (typeof Android !== 'undefined') {
                    achromatopsia_jsvar.checked = Android.getBooleanValue(achromatopsia_jsvar.id);
                } else {
                    elementUpdateFunctions.set("achromatopsia_onoff", function (value) {
                        achromatopsia_jsvar.checked = value;
                        console.log("achromatopsia new Value: " + value);
                    });
                    /*
                    socket.on('update_settings', function (data) {
                        achromatopsia_jsvar.checked = JSON.parse(data).achromatopsia_onoff;
                        socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: achromatopsia_jsvar.checked, setting_id: "achromatopsia_onoff" });
                    });
                    */
                }
                $(achromatopsia_jsvar).change(function () {
                    if (typeof Android !== 'undefined') {
                        if (achromatopsia_jsvar.checked) {
                            console.log('achromatopsia_onoff' + " activated");
                            Android.activateED(achromatopsia_jsvar.id);
                        } else {
                            console.log('achromatopsia_onoff' + " deactivated");
                            Android.deactivateED(achromatopsia_jsvar.id);
                        }
                    } else {
                        changeValue("achromatopsia_onoff", achromatopsia_jsvar.checked);
                        //socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: achromatopsia_jsvar.checked, setting_id: "achromatopsia" });
                    }
                });


            </script>
        </div>
    </div>

    <!--ed_elements-->
    <div id="achromatopsia_elements" class="edControllElementTable row collapse panel-collapse">
        <div class="panel-body">
            <form class="form-horizontal" action="/action_page.php">
                <!--
achromatopsia_int = ed-name+slider-name
Ausprägung = name
0 = def
-->

<div id="achromatopsia_int_element">
    <label class="control-label">Ausprägung</label>
    <input type="range" min="1" max="100" class="slider form-control" id="achromatopsia_int">
    <script>
        var achromatopsia_int_jsvar = document.getElementById("achromatopsia_int");
        if (typeof Android !== 'undefined') {
            achromatopsia_int_jsvar.value = Android.getLongValue(achromatopsia_int_jsvar.id);
        } else {
            elementUpdateFunctions.set("achromatopsia_int", function (value) {
                achromatopsia_int_jsvar.value = value;
                console.log("achromatopsia_int new Value: " + value);
            });
        }
        $(achromatopsia_int_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(achromatopsia_int_jsvar.id, achromatopsia_int_jsvar.value);
            } else {
                changeValue("achromatopsia_int", parseInt(achromatopsia_int_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: achromatopsia_int_jsvar.value, setting_id: "achromatopsia_int" });
            }
        });
    </script>
</div>

            </form>
        </div>
    </div>
</div>
<!--</div>-->
<!--former end body
</body>
-->
<!--
colorblindness = id
Farbsinnstörungen = name
INSERT_ELEMENTS = ed-control-elements
-->
<!--<div id="colorblindness_control" class="edControl">-->

<div class="edTable col-sm-12 col-md-4 col-lg-3 panel panel-default">

    <!--ed_header-->
    <div id="colorblindness_header" class="edHeader row panel-heading">
        <div data-toggle="collapse" data-target="#colorblindness_elements" align="left" class="col-xs-10">
            <label class="edTitle" id="colorblindness_label">Farbsinnstörungen</label>
        </div>
        <div class="col-xs-2">
            <label class="edOnOffElement">
                <input id="colorblindness_onoff" type="checkbox">
                <span class="lever"></span>
            </label>
            <script>
                var colorblindness_jsvar = document.getElementById("colorblindness_onoff");

                if (typeof Android !== 'undefined') {
                    colorblindness_jsvar.checked = Android.getBooleanValue(colorblindness_jsvar.id);
                } else {
                    elementUpdateFunctions.set("colorblindness_onoff", function (value) {
                        colorblindness_jsvar.checked = value;
                        console.log("colorblindness new Value: " + value);
                    });
                    /*
                    socket.on('update_settings', function (data) {
                        colorblindness_jsvar.checked = JSON.parse(data).colorblindness_onoff;
                        socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: colorblindness_jsvar.checked, setting_id: "colorblindness_onoff" });
                    });
                    */
                }
                $(colorblindness_jsvar).change(function () {
                    if (typeof Android !== 'undefined') {
                        if (colorblindness_jsvar.checked) {
                            console.log('colorblindness_onoff' + " activated");
                            Android.activateED(colorblindness_jsvar.id);
                        } else {
                            console.log('colorblindness_onoff' + " deactivated");
                            Android.deactivateED(colorblindness_jsvar.id);
                        }
                    } else {
                        changeValue("colorblindness_onoff", colorblindness_jsvar.checked);
                        //socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: colorblindness_jsvar.checked, setting_id: "colorblindness" });
                    }
                });


            </script>
        </div>
    </div>

    <!--ed_elements-->
    <div id="colorblindness_elements" class="edControllElementTable row collapse panel-collapse">
        <div class="panel-body">
            <form class="form-horizontal" action="/action_page.php">
                <!--
colorblindness_int = ed-name+slider-name
Ausprägung = name
0 = def
-->

<div id="colorblindness_int_element">
    <label class="control-label">Ausprägung</label>
    <input type="range" min="1" max="100" class="slider form-control" id="colorblindness_int">
    <script>
        var colorblindness_int_jsvar = document.getElementById("colorblindness_int");
        if (typeof Android !== 'undefined') {
            colorblindness_int_jsvar.value = Android.getLongValue(colorblindness_int_jsvar.id);
        } else {
            elementUpdateFunctions.set("colorblindness_int", function (value) {
                colorblindness_int_jsvar.value = value;
                console.log("colorblindness_int new Value: " + value);
            });
        }
        $(colorblindness_int_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(colorblindness_int_jsvar.id, colorblindness_int_jsvar.value);
            } else {
                changeValue("colorblindness_int", parseInt(colorblindness_int_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: colorblindness_int_jsvar.value, setting_id: "colorblindness_int" });
            }
        });
    </script>
</div>
<!--
colorblindness_type = id
Art der Farbsinnstörungen = name
0 = def
INSERT_ELEMENTS = dropdown_elements
-->


<div id="colorblindness_type_element">
    <label class="control-label">Art der Farbsinnstörungen</label>

    <select class="form-control" id="colorblindness_type">
        <!--
colorblindness_type = id (Dropdown)
0 = e_id
Rotblindheit = element
-->
<option id="colorblindness_type_dropdown_element_0" value="0">Rotblindheit</option>
<!--
colorblindness_type = id (Dropdown)
1 = e_id
Grünblindheit = element
-->
<option id="colorblindness_type_dropdown_element_1" value="1">Grünblindheit</option>
<!--
colorblindness_type = id (Dropdown)
2 = e_id
Blaublindheit = element
-->
<option id="colorblindness_type_dropdown_element_2" value="2">Blaublindheit</option>

    </select>
    <script>
        var colorblindness_type_jsvar = document.getElementById("colorblindness_type");
        if (typeof Android !== 'undefined') {
            colorblindness_type_jsvar.selectedIndex = Android.getLongValue(colorblindness_type_jsvar.id);
        } else {
            elementUpdateFunctions.set("colorblindness_type", function (value) {
                colorblindness_type_jsvar.selectedIndex = value;
                console.log("colorblindness_type new Value: " + value);
            });
        }
        $(colorblindness_type_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(colorblindness_type_jsvar.id, colorblindness_type_jsvar.selectedIndex);
            } else {
                changeValue("colorblindness_type", colorblindness_type_jsvar.selectedIndex);
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: colorblindness_type_jsvar.selectedIndex, setting_id: "colorblindness_type" });
            }
        });


    </script>
</div>

            </form>
        </div>
    </div>
</div>
<!--</div>-->
<!--former end body
</body>
-->
<!--
ct = id
Grauer Star = name
INSERT_ELEMENTS = ed-control-elements
-->
<!--<div id="ct_control" class="edControl">-->

<div class="edTable col-sm-12 col-md-4 col-lg-3 panel panel-default">

    <!--ed_header-->
    <div id="ct_header" class="edHeader row panel-heading">
        <div data-toggle="collapse" data-target="#ct_elements" align="left" class="col-xs-10">
            <label class="edTitle" id="ct_label">Grauer Star</label>
        </div>
        <div class="col-xs-2">
            <label class="edOnOffElement">
                <input id="ct_onoff" type="checkbox">
                <span class="lever"></span>
            </label>
            <script>
                var ct_jsvar = document.getElementById("ct_onoff");

                if (typeof Android !== 'undefined') {
                    ct_jsvar.checked = Android.getBooleanValue(ct_jsvar.id);
                } else {
                    elementUpdateFunctions.set("ct_onoff", function (value) {
                        ct_jsvar.checked = value;
                        console.log("ct new Value: " + value);
                    });
                    /*
                    socket.on('update_settings', function (data) {
                        ct_jsvar.checked = JSON.parse(data).ct_onoff;
                        socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: ct_jsvar.checked, setting_id: "ct_onoff" });
                    });
                    */
                }
                $(ct_jsvar).change(function () {
                    if (typeof Android !== 'undefined') {
                        if (ct_jsvar.checked) {
                            console.log('ct_onoff' + " activated");
                            Android.activateED(ct_jsvar.id);
                        } else {
                            console.log('ct_onoff' + " deactivated");
                            Android.deactivateED(ct_jsvar.id);
                        }
                    } else {
                        changeValue("ct_onoff", ct_jsvar.checked);
                        //socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: ct_jsvar.checked, setting_id: "ct" });
                    }
                });


            </script>
        </div>
    </div>

    <!--ed_elements-->
    <div id="ct_elements" class="edControllElementTable row collapse panel-collapse">
        <div class="panel-body">
            <form class="form-horizontal" action="/action_page.php">
                <!--
ct_blur_factor = ed-name+slider-name
Blur-Faktor = name
0 = def
-->

<div id="ct_blur_factor_element">
    <label class="control-label">Blur-Faktor</label>
    <input type="range" min="1" max="100" class="slider form-control" id="ct_blur_factor">
    <script>
        var ct_blur_factor_jsvar = document.getElementById("ct_blur_factor");
        if (typeof Android !== 'undefined') {
            ct_blur_factor_jsvar.value = Android.getLongValue(ct_blur_factor_jsvar.id);
        } else {
            elementUpdateFunctions.set("ct_blur_factor", function (value) {
                ct_blur_factor_jsvar.value = value;
                console.log("ct_blur_factor new Value: " + value);
            });
        }
        $(ct_blur_factor_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(ct_blur_factor_jsvar.id, ct_blur_factor_jsvar.value);
            } else {
                changeValue("ct_blur_factor", parseInt(ct_blur_factor_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: ct_blur_factor_jsvar.value, setting_id: "ct_blur_factor" });
            }
        });
    </script>
</div>
<!--
ct_contrast_factor = ed-name+slider-name
Farbsättigungs-Faktor = name
0 = def
-->

<div id="ct_contrast_factor_element">
    <label class="control-label">Farbsättigungs-Faktor</label>
    <input type="range" min="1" max="100" class="slider form-control" id="ct_contrast_factor">
    <script>
        var ct_contrast_factor_jsvar = document.getElementById("ct_contrast_factor");
        if (typeof Android !== 'undefined') {
            ct_contrast_factor_jsvar.value = Android.getLongValue(ct_contrast_factor_jsvar.id);
        } else {
            elementUpdateFunctions.set("ct_contrast_factor", function (value) {
                ct_contrast_factor_jsvar.value = value;
                console.log("ct_contrast_factor new Value: " + value);
            });
        }
        $(ct_contrast_factor_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(ct_contrast_factor_jsvar.id, ct_contrast_factor_jsvar.value);
            } else {
                changeValue("ct_contrast_factor", parseInt(ct_contrast_factor_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: ct_contrast_factor_jsvar.value, setting_id: "ct_contrast_factor" });
            }
        });
    </script>
</div>

            </form>
        </div>
    </div>
</div>
<!--</div>-->
<!--former end body
</body>
-->
<!--
glaucoma = id
Grüner Star = name
INSERT_ELEMENTS = ed-control-elements
-->
<!--<div id="glaucoma_control" class="edControl">-->

<div class="edTable col-sm-12 col-md-4 col-lg-3 panel panel-default">

    <!--ed_header-->
    <div id="glaucoma_header" class="edHeader row panel-heading">
        <div data-toggle="collapse" data-target="#glaucoma_elements" align="left" class="col-xs-10">
            <label class="edTitle" id="glaucoma_label">Grüner Star</label>
        </div>
        <div class="col-xs-2">
            <label class="edOnOffElement">
                <input id="glaucoma_onoff" type="checkbox">
                <span class="lever"></span>
            </label>
            <script>
                var glaucoma_jsvar = document.getElementById("glaucoma_onoff");

                if (typeof Android !== 'undefined') {
                    glaucoma_jsvar.checked = Android.getBooleanValue(glaucoma_jsvar.id);
                } else {
                    elementUpdateFunctions.set("glaucoma_onoff", function (value) {
                        glaucoma_jsvar.checked = value;
                        console.log("glaucoma new Value: " + value);
                    });
                    /*
                    socket.on('update_settings', function (data) {
                        glaucoma_jsvar.checked = JSON.parse(data).glaucoma_onoff;
                        socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: glaucoma_jsvar.checked, setting_id: "glaucoma_onoff" });
                    });
                    */
                }
                $(glaucoma_jsvar).change(function () {
                    if (typeof Android !== 'undefined') {
                        if (glaucoma_jsvar.checked) {
                            console.log('glaucoma_onoff' + " activated");
                            Android.activateED(glaucoma_jsvar.id);
                        } else {
                            console.log('glaucoma_onoff' + " deactivated");
                            Android.deactivateED(glaucoma_jsvar.id);
                        }
                    } else {
                        changeValue("glaucoma_onoff", glaucoma_jsvar.checked);
                        //socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: glaucoma_jsvar.checked, setting_id: "glaucoma" });
                    }
                });


            </script>
        </div>
    </div>

    <!--ed_elements-->
    <div id="glaucoma_elements" class="edControllElementTable row collapse panel-collapse">
        <div class="panel-body">
            <form class="form-horizontal" action="/action_page.php">
                <!--
glaucoma_fov = ed-name+slider-name
Sichtfeld-Einschränkung = name
0 = def
-->

<div id="glaucoma_fov_element">
    <label class="control-label">Sichtfeld-Einschränkung</label>
    <input type="range" min="1" max="100" class="slider form-control" id="glaucoma_fov">
    <script>
        var glaucoma_fov_jsvar = document.getElementById("glaucoma_fov");
        if (typeof Android !== 'undefined') {
            glaucoma_fov_jsvar.value = Android.getLongValue(glaucoma_fov_jsvar.id);
        } else {
            elementUpdateFunctions.set("glaucoma_fov", function (value) {
                glaucoma_fov_jsvar.value = value;
                console.log("glaucoma_fov new Value: " + value);
            });
        }
        $(glaucoma_fov_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(glaucoma_fov_jsvar.id, glaucoma_fov_jsvar.value);
            } else {
                changeValue("glaucoma_fov", parseInt(glaucoma_fov_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: glaucoma_fov_jsvar.value, setting_id: "glaucoma_fov" });
            }
        });
    </script>
</div>

            </form>
        </div>
    </div>
</div>
<!--</div>-->
<!--former end body
</body>
-->
<!--
maculardegeneration = id
Makuladegeneration = name
INSERT_ELEMENTS = ed-control-elements
-->
<!--<div id="maculardegeneration_control" class="edControl">-->

<div class="edTable col-sm-12 col-md-4 col-lg-3 panel panel-default">

    <!--ed_header-->
    <div id="maculardegeneration_header" class="edHeader row panel-heading">
        <div data-toggle="collapse" data-target="#maculardegeneration_elements" align="left" class="col-xs-10">
            <label class="edTitle" id="maculardegeneration_label">Makuladegeneration</label>
        </div>
        <div class="col-xs-2">
            <label class="edOnOffElement">
                <input id="maculardegeneration_onoff" type="checkbox">
                <span class="lever"></span>
            </label>
            <script>
                var maculardegeneration_jsvar = document.getElementById("maculardegeneration_onoff");

                if (typeof Android !== 'undefined') {
                    maculardegeneration_jsvar.checked = Android.getBooleanValue(maculardegeneration_jsvar.id);
                } else {
                    elementUpdateFunctions.set("maculardegeneration_onoff", function (value) {
                        maculardegeneration_jsvar.checked = value;
                        console.log("maculardegeneration new Value: " + value);
                    });
                    /*
                    socket.on('update_settings', function (data) {
                        maculardegeneration_jsvar.checked = JSON.parse(data).maculardegeneration_onoff;
                        socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: maculardegeneration_jsvar.checked, setting_id: "maculardegeneration_onoff" });
                    });
                    */
                }
                $(maculardegeneration_jsvar).change(function () {
                    if (typeof Android !== 'undefined') {
                        if (maculardegeneration_jsvar.checked) {
                            console.log('maculardegeneration_onoff' + " activated");
                            Android.activateED(maculardegeneration_jsvar.id);
                        } else {
                            console.log('maculardegeneration_onoff' + " deactivated");
                            Android.deactivateED(maculardegeneration_jsvar.id);
                        }
                    } else {
                        changeValue("maculardegeneration_onoff", maculardegeneration_jsvar.checked);
                        //socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: maculardegeneration_jsvar.checked, setting_id: "maculardegeneration" });
                    }
                });


            </script>
        </div>
    </div>

    <!--ed_elements-->
    <div id="maculardegeneration_elements" class="edControllElementTable row collapse panel-collapse">
        <div class="panel-body">
            <form class="form-horizontal" action="/action_page.php">
                <!--
maculardegeneration_intadvanced = ed-name+slider-name
Stärke (Fortgeschritten) = name
0 = def
-->

<div id="maculardegeneration_intadvanced_element">
    <label class="control-label">Stärke (Fortgeschritten)</label>
    <input type="range" min="1" max="100" class="slider form-control" id="maculardegeneration_intadvanced">
    <script>
        var maculardegeneration_intadvanced_jsvar = document.getElementById("maculardegeneration_intadvanced");
        if (typeof Android !== 'undefined') {
            maculardegeneration_intadvanced_jsvar.value = Android.getLongValue(maculardegeneration_intadvanced_jsvar.id);
        } else {
            elementUpdateFunctions.set("maculardegeneration_intadvanced", function (value) {
                maculardegeneration_intadvanced_jsvar.value = value;
                console.log("maculardegeneration_intadvanced new Value: " + value);
            });
        }
        $(maculardegeneration_intadvanced_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(maculardegeneration_intadvanced_jsvar.id, maculardegeneration_intadvanced_jsvar.value);
            } else {
                changeValue("maculardegeneration_intadvanced", parseInt(maculardegeneration_intadvanced_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: maculardegeneration_intadvanced_jsvar.value, setting_id: "maculardegeneration_intadvanced" });
            }
        });
    </script>
</div>
<!--
maculardegeneration_inteasy = ed-name+slider-name
Ausprägung (Einfach) = name
0 = def
-->

<div id="maculardegeneration_inteasy_element">
    <label class="control-label">Ausprägung (Einfach)</label>
    <input type="range" min="1" max="100" class="slider form-control" id="maculardegeneration_inteasy">
    <script>
        var maculardegeneration_inteasy_jsvar = document.getElementById("maculardegeneration_inteasy");
        if (typeof Android !== 'undefined') {
            maculardegeneration_inteasy_jsvar.value = Android.getLongValue(maculardegeneration_inteasy_jsvar.id);
        } else {
            elementUpdateFunctions.set("maculardegeneration_inteasy", function (value) {
                maculardegeneration_inteasy_jsvar.value = value;
                console.log("maculardegeneration_inteasy new Value: " + value);
            });
        }
        $(maculardegeneration_inteasy_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(maculardegeneration_inteasy_jsvar.id, maculardegeneration_inteasy_jsvar.value);
            } else {
                changeValue("maculardegeneration_inteasy", parseInt(maculardegeneration_inteasy_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: maculardegeneration_inteasy_jsvar.value, setting_id: "maculardegeneration_inteasy" });
            }
        });
    </script>
</div>
<!--
maculardegeneration_radius = ed-name+slider-name
Radius (Fortgeschritten) = name
0 = def
-->

<div id="maculardegeneration_radius_element">
    <label class="control-label">Radius (Fortgeschritten)</label>
    <input type="range" min="1" max="100" class="slider form-control" id="maculardegeneration_radius">
    <script>
        var maculardegeneration_radius_jsvar = document.getElementById("maculardegeneration_radius");
        if (typeof Android !== 'undefined') {
            maculardegeneration_radius_jsvar.value = Android.getLongValue(maculardegeneration_radius_jsvar.id);
        } else {
            elementUpdateFunctions.set("maculardegeneration_radius", function (value) {
                maculardegeneration_radius_jsvar.value = value;
                console.log("maculardegeneration_radius new Value: " + value);
            });
        }
        $(maculardegeneration_radius_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(maculardegeneration_radius_jsvar.id, maculardegeneration_radius_jsvar.value);
            } else {
                changeValue("maculardegeneration_radius", parseInt(maculardegeneration_radius_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: maculardegeneration_radius_jsvar.value, setting_id: "maculardegeneration_radius" });
            }
        });
    </script>
</div>
<!--
maculardegeneration_vadvanced = id (Radio)
maculardegeneration = id (ElementsGroup)
Forgeschritten = name
false = def
-->
<div id="maculardegeneration_vadvanced_element">
    <!--<label class="control-label" for="maculardegeneration_vadvanced">Forgeschritten</label>-->
    <div class="radio">
        <label><input type="radio" name="maculardegeneration_name" value="0" id="maculardegeneration_vadvanced" />Forgeschritten</label>
    </div>
    <script>
        var maculardegeneration_vadvanced_jsvar = document.getElementById("maculardegeneration_vadvanced");
        if (typeof Android !== 'undefined') {
            maculardegeneration_vadvanced_jsvar.checked = Android.getBooleanValue(maculardegeneration_vadvanced_jsvar.id);
        } else {
            elementUpdateFunctions.set("maculardegeneration_vadvanced", function (value) {
                maculardegeneration_vadvanced_jsvar.checked = value;
                console.log("maculardegeneration_vadvanced new Value: " + value);
            });
        }
        $(maculardegeneration_vadvanced_jsvar).change(function () {
            var maculardegeneration_name_list = document.querySelectorAll('input[name="maculardegeneration_name"]');
            for (var i = 0; i < maculardegeneration_name_list.length; i++) {
                if (typeof Android !== 'undefined') {
                    Android.changeValues(maculardegeneration_name_list[i].id, maculardegeneration_name_list[i].checked);
                } else {
                    changeValue(maculardegeneration_name_list[i].id, maculardegeneration_name_list[i].checked);
                    //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: maculardegeneration_name_list[i].checked, setting_id: maculardegeneration_name_list[i].id });
                }
            }
        });


    </script>
</div>
<!--
maculardegeneration_veasy = id (Radio)
maculardegeneration = id (ElementsGroup)
Einfach = name
true = def
-->
<div id="maculardegeneration_veasy_element">
    <!--<label class="control-label" for="maculardegeneration_veasy">Einfach</label>-->
    <div class="radio">
        <label><input type="radio" name="maculardegeneration_name" value="0" id="maculardegeneration_veasy" />Einfach</label>
    </div>
    <script>
        var maculardegeneration_veasy_jsvar = document.getElementById("maculardegeneration_veasy");
        if (typeof Android !== 'undefined') {
            maculardegeneration_veasy_jsvar.checked = Android.getBooleanValue(maculardegeneration_veasy_jsvar.id);
        } else {
            elementUpdateFunctions.set("maculardegeneration_veasy", function (value) {
                maculardegeneration_veasy_jsvar.checked = value;
                console.log("maculardegeneration_veasy new Value: " + value);
            });
        }
        $(maculardegeneration_veasy_jsvar).change(function () {
            var maculardegeneration_name_list = document.querySelectorAll('input[name="maculardegeneration_name"]');
            for (var i = 0; i < maculardegeneration_name_list.length; i++) {
                if (typeof Android !== 'undefined') {
                    Android.changeValues(maculardegeneration_name_list[i].id, maculardegeneration_name_list[i].checked);
                } else {
                    changeValue(maculardegeneration_name_list[i].id, maculardegeneration_name_list[i].checked);
                    //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: maculardegeneration_name_list[i].checked, setting_id: maculardegeneration_name_list[i].id });
                }
            }
        });


    </script>
</div>

            </form>
        </div>
    </div>
</div>
<!--</div>-->
<!--former end body
</body>
-->
<!--
myopiahyperopia = id
Kurz-/Weitsichtigkeit = name
INSERT_ELEMENTS = ed-control-elements
-->
<!--<div id="myopiahyperopia_control" class="edControl">-->

<div class="edTable col-sm-12 col-md-4 col-lg-3 panel panel-default">

    <!--ed_header-->
    <div id="myopiahyperopia_header" class="edHeader row panel-heading">
        <div data-toggle="collapse" data-target="#myopiahyperopia_elements" align="left" class="col-xs-10">
            <label class="edTitle" id="myopiahyperopia_label">Kurz-/Weitsichtigkeit</label>
        </div>
        <div class="col-xs-2">
            <label class="edOnOffElement">
                <input id="myopiahyperopia_onoff" type="checkbox">
                <span class="lever"></span>
            </label>
            <script>
                var myopiahyperopia_jsvar = document.getElementById("myopiahyperopia_onoff");

                if (typeof Android !== 'undefined') {
                    myopiahyperopia_jsvar.checked = Android.getBooleanValue(myopiahyperopia_jsvar.id);
                } else {
                    elementUpdateFunctions.set("myopiahyperopia_onoff", function (value) {
                        myopiahyperopia_jsvar.checked = value;
                        console.log("myopiahyperopia new Value: " + value);
                    });
                    /*
                    socket.on('update_settings', function (data) {
                        myopiahyperopia_jsvar.checked = JSON.parse(data).myopiahyperopia_onoff;
                        socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: myopiahyperopia_jsvar.checked, setting_id: "myopiahyperopia_onoff" });
                    });
                    */
                }
                $(myopiahyperopia_jsvar).change(function () {
                    if (typeof Android !== 'undefined') {
                        if (myopiahyperopia_jsvar.checked) {
                            console.log('myopiahyperopia_onoff' + " activated");
                            Android.activateED(myopiahyperopia_jsvar.id);
                        } else {
                            console.log('myopiahyperopia_onoff' + " deactivated");
                            Android.deactivateED(myopiahyperopia_jsvar.id);
                        }
                    } else {
                        changeValue("myopiahyperopia_onoff", myopiahyperopia_jsvar.checked);
                        //socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: myopiahyperopia_jsvar.checked, setting_id: "myopiahyperopia" });
                    }
                });


            </script>
        </div>
    </div>

    <!--ed_elements-->
    <div id="myopiahyperopia_elements" class="edControllElementTable row collapse panel-collapse">
        <div class="panel-body">
            <form class="form-horizontal" action="/action_page.php">
                <!--
myopiahyperopia_mnh = ed-name+slider-name
Kurzsichtig (-3 dpt) - Weitsichtig (+3 dpt) = name
50 = def
-->

<div id="myopiahyperopia_mnh_element">
    <label class="control-label">Kurzsichtig (-3 dpt) - Weitsichtig (+3 dpt)</label>
    <input type="range" min="1" max="100" class="slider form-control" id="myopiahyperopia_mnh">
    <script>
        var myopiahyperopia_mnh_jsvar = document.getElementById("myopiahyperopia_mnh");
        if (typeof Android !== 'undefined') {
            myopiahyperopia_mnh_jsvar.value = Android.getLongValue(myopiahyperopia_mnh_jsvar.id);
        } else {
            elementUpdateFunctions.set("myopiahyperopia_mnh", function (value) {
                myopiahyperopia_mnh_jsvar.value = value;
                console.log("myopiahyperopia_mnh new Value: " + value);
            });
        }
        $(myopiahyperopia_mnh_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(myopiahyperopia_mnh_jsvar.id, myopiahyperopia_mnh_jsvar.value);
            } else {
                changeValue("myopiahyperopia_mnh", parseInt(myopiahyperopia_mnh_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: myopiahyperopia_mnh_jsvar.value, setting_id: "myopiahyperopia_mnh" });
            }
        });
    </script>
</div>

            </form>
        </div>
    </div>
</div>
<!--</div>-->
<!--former end body
</body>
-->
<!--
nyctalopia = id
Nachtblindheit = name
INSERT_ELEMENTS = ed-control-elements
-->
<!--<div id="nyctalopia_control" class="edControl">-->

<div class="edTable col-sm-12 col-md-4 col-lg-3 panel panel-default">

    <!--ed_header-->
    <div id="nyctalopia_header" class="edHeader row panel-heading">
        <div data-toggle="collapse" data-target="#nyctalopia_elements" align="left" class="col-xs-10">
            <label class="edTitle" id="nyctalopia_label">Nachtblindheit</label>
        </div>
        <div class="col-xs-2">
            <label class="edOnOffElement">
                <input id="nyctalopia_onoff" type="checkbox">
                <span class="lever"></span>
            </label>
            <script>
                var nyctalopia_jsvar = document.getElementById("nyctalopia_onoff");

                if (typeof Android !== 'undefined') {
                    nyctalopia_jsvar.checked = Android.getBooleanValue(nyctalopia_jsvar.id);
                } else {
                    elementUpdateFunctions.set("nyctalopia_onoff", function (value) {
                        nyctalopia_jsvar.checked = value;
                        console.log("nyctalopia new Value: " + value);
                    });
                    /*
                    socket.on('update_settings', function (data) {
                        nyctalopia_jsvar.checked = JSON.parse(data).nyctalopia_onoff;
                        socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: nyctalopia_jsvar.checked, setting_id: "nyctalopia_onoff" });
                    });
                    */
                }
                $(nyctalopia_jsvar).change(function () {
                    if (typeof Android !== 'undefined') {
                        if (nyctalopia_jsvar.checked) {
                            console.log('nyctalopia_onoff' + " activated");
                            Android.activateED(nyctalopia_jsvar.id);
                        } else {
                            console.log('nyctalopia_onoff' + " deactivated");
                            Android.deactivateED(nyctalopia_jsvar.id);
                        }
                    } else {
                        changeValue("nyctalopia_onoff", nyctalopia_jsvar.checked);
                        //socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: nyctalopia_jsvar.checked, setting_id: "nyctalopia" });
                    }
                });


            </script>
        </div>
    </div>

    <!--ed_elements-->
    <div id="nyctalopia_elements" class="edControllElementTable row collapse panel-collapse">
        <div class="panel-body">
            <form class="form-horizontal" action="/action_page.php">
                <!--
nyctalopia_int = ed-name+slider-name
Ausprägung = name
0 = def
-->

<div id="nyctalopia_int_element">
    <label class="control-label">Ausprägung</label>
    <input type="range" min="1" max="100" class="slider form-control" id="nyctalopia_int">
    <script>
        var nyctalopia_int_jsvar = document.getElementById("nyctalopia_int");
        if (typeof Android !== 'undefined') {
            nyctalopia_int_jsvar.value = Android.getLongValue(nyctalopia_int_jsvar.id);
        } else {
            elementUpdateFunctions.set("nyctalopia_int", function (value) {
                nyctalopia_int_jsvar.value = value;
                console.log("nyctalopia_int new Value: " + value);
            });
        }
        $(nyctalopia_int_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(nyctalopia_int_jsvar.id, nyctalopia_int_jsvar.value);
            } else {
                changeValue("nyctalopia_int", parseInt(nyctalopia_int_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: nyctalopia_int_jsvar.value, setting_id: "nyctalopia_int" });
            }
        });
    </script>
</div>

            </form>
        </div>
    </div>
</div>
<!--</div>-->
<!--former end body
</body>
-->
<!--
presbyopia = id
Alterssichtigkeit = name
INSERT_ELEMENTS = ed-control-elements
-->
<!--<div id="presbyopia_control" class="edControl">-->

<div class="edTable col-sm-12 col-md-4 col-lg-3 panel panel-default">

    <!--ed_header-->
    <div id="presbyopia_header" class="edHeader row panel-heading">
        <div data-toggle="collapse" data-target="#presbyopia_elements" align="left" class="col-xs-10">
            <label class="edTitle" id="presbyopia_label">Alterssichtigkeit</label>
        </div>
        <div class="col-xs-2">
            <label class="edOnOffElement">
                <input id="presbyopia_onoff" type="checkbox">
                <span class="lever"></span>
            </label>
            <script>
                var presbyopia_jsvar = document.getElementById("presbyopia_onoff");

                if (typeof Android !== 'undefined') {
                    presbyopia_jsvar.checked = Android.getBooleanValue(presbyopia_jsvar.id);
                } else {
                    elementUpdateFunctions.set("presbyopia_onoff", function (value) {
                        presbyopia_jsvar.checked = value;
                        console.log("presbyopia new Value: " + value);
                    });
                    /*
                    socket.on('update_settings', function (data) {
                        presbyopia_jsvar.checked = JSON.parse(data).presbyopia_onoff;
                        socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: presbyopia_jsvar.checked, setting_id: "presbyopia_onoff" });
                    });
                    */
                }
                $(presbyopia_jsvar).change(function () {
                    if (typeof Android !== 'undefined') {
                        if (presbyopia_jsvar.checked) {
                            console.log('presbyopia_onoff' + " activated");
                            Android.activateED(presbyopia_jsvar.id);
                        } else {
                            console.log('presbyopia_onoff' + " deactivated");
                            Android.deactivateED(presbyopia_jsvar.id);
                        }
                    } else {
                        changeValue("presbyopia_onoff", presbyopia_jsvar.checked);
                        //socket.emit('setting_changed', { emitName: "onoff_changed", androidId: checkboxChecked, setting_value: presbyopia_jsvar.checked, setting_id: "presbyopia" });
                    }
                });


            </script>
        </div>
    </div>

    <!--ed_elements-->
    <div id="presbyopia_elements" class="edControllElementTable row collapse panel-collapse">
        <div class="panel-body">
            <form class="form-horizontal" action="/action_page.php">
                <!--
presbyopia_near_point = ed-name+slider-name
Nahpunkt (0 bis 1 Meter) = name
0 = def
-->

<div id="presbyopia_near_point_element">
    <label class="control-label">Nahpunkt (0 bis 1 Meter)</label>
    <input type="range" min="1" max="100" class="slider form-control" id="presbyopia_near_point">
    <script>
        var presbyopia_near_point_jsvar = document.getElementById("presbyopia_near_point");
        if (typeof Android !== 'undefined') {
            presbyopia_near_point_jsvar.value = Android.getLongValue(presbyopia_near_point_jsvar.id);
        } else {
            elementUpdateFunctions.set("presbyopia_near_point", function (value) {
                presbyopia_near_point_jsvar.value = value;
                console.log("presbyopia_near_point new Value: " + value);
            });
        }
        $(presbyopia_near_point_jsvar).change(function () {
            if (typeof Android !== 'undefined') {
                Android.changeValues(presbyopia_near_point_jsvar.id, presbyopia_near_point_jsvar.value);
            } else {
                changeValue("presbyopia_near_point", parseInt(presbyopia_near_point_jsvar.value));
                //socket.emit('setting_changed', { emitName: "setting_changed", androidId: checkboxChecked, setting_value: presbyopia_near_point_jsvar.value, setting_id: "presbyopia_near_point" });
            }
        });
    </script>
</div>

            </form>
        </div>
    </div>
</div>
<!--</div>-->
<!--former end body
</body>
-->

        </div>
      </div>

      <!-- Import export -->
      <div role="tabpanel" class="tab-pane" id="2">

        <div class="row">
          <button id="dlBtn" onclick="downloadConfig()" class="btn" >Save config</button>

          <!-- Upload config -->
          <label class="btn btn-default btn-file">
            Upload config: <input type='file' accept='*' style="display: none;" onchange='openFile(event)' />
          </label>

        </div>
      </div>

      <!-- File upload -->
      <div role="tabpanel" class="tab-pane" id="3">
        <!-- Upload input image -->
        <label class="btn btn-default btn-file">
          Upload input <input type='file' accept='.png' style="display: none;" onchange='sendInput(event)' />
        </label>

        <!-- Upload retina image -->
        <label class="btn btn-default btn-file">
          Upload retina map <input type='file' accept='.png' style="display: none;" onchange='sendRetina(event)' />
        </label>

        <!-- Upload depth image -->
        <label class="btn btn-default btn-file">
          Upload depth map <input type='file' accept='.png' style="display: none;" onchange='sendDepth(event)' />
        </label>

        <!-- Upload cornea image -->
        <label class="btn btn-default btn-file">
          Upload cornea map <input type='file' accept='.png' style="display: none;" onchange='sendCornea(event)' />
        </label>

      </div>

      <!-- Drawing Mode -->
      <div role="tabpanel" class="tab-pane" id="4">

        <div class="row">
          <button onclick="sendBoardInput()">Set input</button>
          <button onclick="sendBoardRetina()">Set retina</button>
        </div>

        (Alpha channel for rod cell only supported via image upload

        <div id="board"></div>
        <script>
        var myBoard = new DrawingBoard.Board('board', {
          background: "#fff",
          size: 30,
          controls: [
            'Color',
            { Size: { type: "range" } },
            { Navigation: { back: false, forward: false } },
            'DrawingMode'
          ],
          webStorage: 'local'
        });
        </script>

      </div>
    </div>


  </div>

  <script>

  //load default settings on startup
  updateSettingElements(simulationValues);

  </script>
</body>
</html>
